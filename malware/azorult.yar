rule azorult_win32_unpack {
    meta:
        author =  "tccontre"
        description = "detecting azorult malware"
        date =  "2019-01-23"
        sha256 = "ae75cd28bc2309f085f79bc8bd480e797b5e42f852c40a8cc733e1a51a7c5fa9"
   
    strings:
        $mz = { 4d 5a }
       
        $s1 = "FROM moz_places, moz_historyvisits WHERE" fullword
       
        $c0 = "\\accounts.xml" fullword wide
        $c1 = "PortNumber" fullword wide
        $c2 = "\\places.sqlite" fullword wide

        $code1 = { 81 F1 8A 45 21 65 03 D9 8B CB C1 E1 0D 8B F3 C1 EE 13 0B CE 2B D9 42 48 }
                
    condition:
        ($mz at 0) and all of ($s*) and 2 of ($c*) and all of ($code*)
}

rule AzorultByKeyword {
    meta:
        author = "@neonprimetime"
        description = "Azorult"
    strings:
        $string1 = "wallet.dat"
        $string2 = "PasswordsList.txt"
        $string3 = "timeout.exe"
        $string4 = "Wscript.Shell"
    condition:
        3 of them
}

rule azorult3
{
meta:
        author = "futex"
        date = "2018-04-30"
        description = "Azorult3"
        sample_filetype = "exe"
strings:
        $string0 = "</Port>" wide
        $string1 = "004080"
        $string2 = "\\ssfn*" wide
        $string3 = "<f<n<v<"
        $string4 = "Password" wide
        $string5 = "</RecentServers>" wide
        $string6 = "FPUMaskValue"
        $string7 = "2d2h2l2p2t2x2"
        $string8 = "GetRAM: "
        $string9 = "%APPDATA%\\MultiBitHD" wide
        $string10 = "VaultEnumerateItems"
        $string11 = "VaultGetItem"
        $string12 = "1.161>1F1N1V1"
        $string13 = "BuildImportTable: GetProcAddress failed"
        $string14 = "PortNumber" wide
        $string15 = "8)838I8O8]8p8z8"
        $string16 = "_CC.txt" wide
        $string17 = "VaultOpenVault"
        $string18 = "<Pass>" wide
condition:
        18 of them
}